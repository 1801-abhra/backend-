<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Driver Dashboard</title>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<style>
body {
font-family: Arial, sans-serif;
background: #f4f4f4;
padding: 20px;
}
h1 {
text-align: center;
}
.ride {
background: white;
padding: 15px;
margin: 10px 0;
border-radius: 5px;
box-shadow: 0 0 5px rgba(0,0,0,0.1);
}
button {
margin-right: 10px;
padding: 8px 12px;
cursor: pointer;
}
</style>
</head>

<body>

<h1>ðŸš• Driver Dashboard</h1>

<div id="rides"></div>

<script>
const API_BASE = "https://traverse-backend-mvdv.onrender.com";
const socket = io(API_BASE);

socket.on("connect", () => {
console.log("Driver connected:", socket.id);
});

socket.on("ride:new", (ride) => {
addRide(ride);
});

async function loadRides() {
const res = await fetch(`${API_BASE}/api/rides`);
const rides = await res.json();
rides.forEach(addRide);
}

function addRide(ride) {
if (ride.status !== "requested") return;

const div = document.createElement("div");
div.className = "ride";
div.id = ride._id;

div.innerHTML = `
<p><b>Pickup:</b> ${ride.pickup.address}</p>
<p><b>Drop:</b> ${ride.drop.address}</p>
<p><b>Status:</b> ${ride.status}</p>
<button onclick="updateStatus('${ride._id}', 'accepted')">Accept</button>
<button onclick="updateStatus('${ride._id}', 'rejected')">Reject</button>
`;

document.getElementById("rides").appendChild(div);
}

async function updateStatus(id, status) {
await fetch(`${API_BASE}/api/rides/${id}/status`, {
method: "PATCH",
headers: { "Content-Type": "application/json" },
body: JSON.stringify({ status })
});

document.getElementById(id).remove();
}

loadRides();
</script>

</body>
</html>
